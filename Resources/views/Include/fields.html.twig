{% block oro_entity_option_set_widget %}
    <div class="email-holder {% if form.label.vars.errors|length > 0 %} validation-error{% endif %}">
        <div class="input-append collection-element-primary">
            {{ form_widget(form.label) }}
            <label class="add-on" title="{{ 'Default'|trans }}">
                {{ form_widget(form.default) }}
            </label>
            <label class="add-on" title="{{ 'Priority'|trans }}">
                <i class="icon-list handle"></i>
                {{ form_widget(form.priority, {'attr': {'class': 'priority'}}) }}
            </label>
        </div>
        {{ form_errors(form.label) }}
    </div>
    {{ form_rest(form) }}
    <script type="text/javascript">
        require(['jquery'],
            function($){
                $('#oro_entity_config_type_extend_set_options_collection').sortable({
                    axis  : 'y',
                    cursor: 'move',
                    delay : 100,
                    handle: '.handle',
                    stop  : function () {
                        var index = 1;
                        $('#oro_entity_config_type_extend_set_options_collection input.priority').each(function(i, el){
                            $(el).val(index++);
                        })
                    }
                });
            }
        );
    </script>
{% endblock %}

{% block oro_item_collection_widget %}
{% spaceless %}
    {% import 'OroAddressBundle:Include:fields.html.twig' as _address %}
    {% set prototypeHtml = _address.oro_collection_item_prototype(form) %}
    <div class="row-oro">
        <div class="oro-item-collection collection-fields-list" id="{{ id }}_collection" data-prototype="{{ prototypeHtml|escape }}">
            {% if form.children|length %}
                {% for child in form.children %}
                    {{ _address.oro_collection_item_prototype(child) }}
                {% endfor %}
            {% elseif show_form_when_empty %}
                {{ prototypeHtml|replace({'__name__': '0'})|raw }}
            {% endif %}
        </div>
        <a class="btn add-list-item" href="javascript: void(0);"><i class="icon-plus"></i>{{ 'Add'|trans }}</a>
    </div>
    {{ _self.oro_item_collection_validate_default_js(_context) }}
{% endspaceless %}
{% endblock %}

{% macro oro_item_collection_validate_default_js(context) %}
    {% set form = context.form %}
    {% set id = context.id %}
    {% set show_form_when_empty = context.show_form_when_empty %}
    {% set has_default = form.vars.prototype.default is defined %}

    {% if has_default or show_form_when_empty %}
        <script type="text/javascript">
            require(['jquery'],
            function($){
                $(function() {
                    var container = $('#{{ id }}_collection');

                    {% if has_default %}
                    /**
                     * Allow only 1 primary checkbox to be checked.
                     * This logic convert checkbox logic to logic used in radiobutton
                     */
                    container.on('click', '[name$="[default]"]', function() {
                        container.find('[name$="[default]"]').each(function (idx, el) {
                            el.checked = false;
                        });
                        this.checked = true;
                    });
                    {% endif %}
                });
            });
        </script>
    {% endif %}
{% endmacro %}
