{% extends 'OroUIBundle:actions:update.html.twig' %}
{#{% set format = oro_config_value('oro_user.name_format') %}#}
{% form_theme form with 'OroUIBundle:Form:fields.html.twig' %}


{#{% set title = form.vars.value.id ? form.vars.value.fullname(format)|default('N/A') ~ ' - ' ~ 'Update User'|trans : 'New User'|trans %}#}
{% set title = 'Update Entity' %}


{#{% oro_title_set({params : {"%username%": form.vars.value.fullname(format)|default('N/A') }}) %}#}
{% oro_title_set({params : {"%username%": 'User' }}) %}

{#{% set entityClass = 'Oro_Bundle_UserBundle_Entity_User' %}#}


{#{% set formAction = form.vars.value.id ? path('oro_user_update', { id: form.vars.value.id}) : path('oro_user_create') %}#}
{% set formAction = path('oro_entityconfig_update', {id: 2}) %}


{% block navButtons %}
    {#{% if form.vars.value.id and resource_granted('oro_user_user_delete') and  form.vars.value.id!=app.user.id %}#}
        {#{{ UI.deleteButton({#}
        {#'dataUrl': path('oro_api_delete_user', {'id': form.vars.value.id}),#}
        {#'dataRedirect': path('oro_user_index'),#}
        {#'aCss': 'no-hash remove-button',#}
        {#'id': 'btn-remove-user',#}
        {#'dataId':  form.vars.value.id,#}
        {#'dataMessage': 'Are you sure you want to delete this user?',#}
        {#'title': 'Delete user',#}
        {#'label': 'Delete'#}
        {#}) }}#}
        {#{{ UI.buttonSeparator() }}#}
    {#{% endif %}#}

    {{ UI.button({'path' : path('oro_entityconfig_index'), 'title' : 'Cancel', 'label' : 'Cancel'}) }}
    {{ UI.buttonType({'type': 'submit', 'class': 'btn-success', 'label': 'Save'}) }}
{% endblock navButtons %}


{% block pageHeader %}
    {#{% if form.vars.value.id %}#}
        {#{% set breadcrumbs = {#}
            {#'entity':      form.vars.value,#}
            {#'indexPath':   path('oro_entityconfig_index'),#}
            {#'indexLabel': 'Entities',#}
            {#'entityTitle': form.vars.value.fullname(format)|default('N/A'),#}
            {#'hasAvatar':   false,#}
            {#'imagePath':   '',#}
        {#}#}
        {% set breadcrumbs = {
            'entity':      'entity',
            'indexPath':   path('oro_entityconfig_index'),
            'indexLabel': 'Entities',
            'entityTitle': 'N/A',
            'hasAvatar':   false,
            'imagePath':   '',
        }
        %}
        {{ parent() }}
    {#{% else %}#}
        {#{% include 'OroUIBundle::page_title_block.html.twig' %}#}
    {#{% endif %}#}
{% endblock pageHeader %}

{% block stats %}
    {{ parent() }}
    {#<li>{{ 'Last logged in'|trans }}: {{ form.vars.value.lastLogin ? UI.time(form.vars.value.lastLogin) : 'N/A' }}</li>#}
    {#<li>{{ 'Login count'|trans }}: {{ form.vars.value.loginCount|default(0) }}</li>#}
{% endblock stats %}


{% block content_data %}
    {% set id = 'configentity-update' %}
    {% set dataBlocks = form_data_blocks(form) %}

    {#{% for scope, block in formConfig %}#}

        {#{% set subblocks = [] %}#}

        {#{% for subblock in block.subblocks %}#}
            {#{% set data = [] %}#}
            {#{% for key, field in subblock.fields %}#}
                {#{{ dump(form.children[scope]) }}#}
                {#&#123;&#35;{% set data = data|merge([ form_row(form.children[scope][field]) ]) %}&#35;&#125;#}
            {#{% endfor %}#}

            {#{% set subblocks = subblocks|merge([{'title': subblock.title, 'data': data }]) %}#}
        {#{% endfor %}#}

        {#{% set dataBlock = {#}
            {#'title': block.title,#}
            {#'class': block.class,#}
            {#'subblocks': subblocks#}
        {#}%}#}

        {#{% set dataBlocks = dataBlocks|merge([dataBlock]) %}#}

    {#{% endfor %}#}

    {{ form_widget(form) }}

    {% set data = {
        'formErrors': form_errors(form)? form_errors(form) : null,
        'dataBlocks': dataBlocks,
        'hiddenData': form_rest(form)
    }%}

    {{ parent() }}
{% endblock content_data %}
